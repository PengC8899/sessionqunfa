<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Telegram 群发控制面板</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <header>
    <h1>Telegram 群发控制面板</h1>
    <div class="token-box">
      <label>管理员令牌</label>
      <input id="adminToken" type="password" placeholder="输入 X-Admin-Token" />
      <button id="saveToken">保存令牌</button>
      <button id="editToken" style="display:none;">编辑令牌</button>
      <span id="tokenStatus" style="margin-left:8px;"></span>
      <label style="margin-left:12px;">账号</label>
      <select id="accountSelect"></select>
    </div>
    <div class="login-box" style="margin-top:8px; display:flex; gap:8px; align-items:center;">
      <input id="loginPhone" type="text" placeholder="手机号(含国家码)" style="width:200px;" />
      <input id="loginCode" type="text" placeholder="验证码" style="width:100px;" />
      <input id="loginPassword" type="password" placeholder="二次密码(如有)" style="width:160px;" />
      <label><input id="forceSms" type="checkbox" /> 强制短信</label>
      <button id="sendCodeBtn">发送验证码</button>
      <button id="confirmLoginBtn">确认登录</button>
      <button id="unlockAccount" style="display:none;">更换账号/重新登录</button>
      <span id="authStatus" style="margin-left:8px;"></span>
    </div>
  </header>

  <main>
    <section class="left">
      <div class="search-box">
        <input id="searchInput" type="text" placeholder="搜索群名" />
        <div class="actions">
          <button id="selectAll">全选</button>
          <button id="clearAll">取消全选</button>
          <button id="refreshGroups">刷新群列表</button>
          <button id="clearCacheBtn">清除缓存</button>
          <button id="debugGroups">诊断群列表</button>
        </div>
      </div>
      <div class="row" style="margin-top:8px;">
        <label><input id="includeChannels" type="checkbox" /> 包含频道</label>
        <span id="groupCount" style="margin-left:12px;"></span>
      </div>
      <ul id="groupList"></ul>
    </section>

    <section class="right">
      <div class="form">
        <textarea id="message" rows="10" placeholder="输入要发送的消息"></textarea>
        <div class="row">
          <label>解析模式</label>
          <select id="parseMode">
            <option value="plain">plain</option>
            <option value="markdown">markdown</option>
            <option value="html">html</option>
          </select>
        </div>
        <div class="row">
          <label>每条间隔(ms)</label>
          <input id="delayMs" type="number" value="60000" />
        </div>
        <div class="row">
          <label>发送轮数</label>
          <input id="rounds" type="number" value="30" min="1" step="1" />
        </div>
        <div class="row">
          <label>每轮间隔(s)</label>
          <input id="roundInterval" type="number" value="1200" min="0" step="60" />
        </div>
        <div class="row">
          <label><input id="disablePreview" type="checkbox" checked /> 关闭链接预览</label>
        </div>
        <div class="actions">
          <button id="sendBtn">发送到选中群组</button>
          <button id="testBtn">发送测试消息</button>
        </div>
        <div id="result" class="result"></div>
      </div>
      <div class="logs">
        <h2>最近日志</h2>
        <table>
          <thead>
            <tr>
              <th>时间</th>
              <th>群名</th>
              <th>状态</th>
              <th>消息ID</th>
              <th>错误</th>
            </tr>
          </thead>
          <tbody id="logsBody"></tbody>
        </table>
      </div>
      <div class="global-summary" style="margin-top:16px;">
        <h2>全局任务面板（每分钟刷新）</h2>
        <div class="row" style="margin-bottom:8px; gap:8px; display:flex; align-items:center;">
          <input id="summarySearch" type="text" placeholder="按账号筛选" style="width:200px;" />
          <button id="summaryRefresh">刷新</button>
          <span id="summaryLoading" style="margin-left:8px;"></span>
          <span id="summaryUpdatedAt" style="margin-left:8px;"></span>
        </div>
        <table>
          <thead>
            <tr>
              <th data-key="account" class="summarySort">账号</th>
              <th data-key="tasks_count" class="summarySort">任务数</th>
              <th data-key="total" class="summarySort">总群数</th>
              <th data-key="success" class="summarySort">成功</th>
              <th data-key="failed" class="summarySort">失败</th>
              <th data-key="progress" class="summarySort">完成度</th>
              <th data-key="rounds" class="summarySort">轮次</th>
              <th data-key="last_updated_at" class="summarySort">更新时间</th>
            </tr>
          </thead>
          <tbody id="globalSummaryBody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <script src="/static/app.js?v=1.1"></script>
</body>
</html>
